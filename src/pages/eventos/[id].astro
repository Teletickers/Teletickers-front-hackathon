---
// src/pages/eventos/[id].astro
import Layout from "../../layouts/Layout.astro";
import Sidebar from "../../components/ui/Sidebar";
import Header from "../../components/ui/Header";
import Footer from "../../components/ui/Footer";
import type { Evento } from "../../types";

export const prerender = false;
---

<Layout title="Detalle del Evento - Ticky">
  <Sidebar client:load />
  <div class="ml-14">
    <Header client:load />
    <div id="evento-detail" class="container mx-auto px-4 py-8"></div>
    <Footer client:load />
  </div>
</Layout>

<script>
  import { client } from "../../lib/apollo-client";
  import { GET_EVENTO } from "../../lib/graphql/queries";
  import type { Evento } from "../../types";

  interface EventoData {
    evento: Evento;
  }

  const pathParts = window.location.pathname.split("/");
  const eventoId = pathParts[pathParts.length - 1];

  async function loadEvento() {
    try {
      const { data } = await client.query<EventoData>({
        query: GET_EVENTO,
        variables: { id: eventoId },
      });

      if (!data || !data.evento) {
        document.getElementById("evento-detail")!.innerHTML =
          "<p>Evento no encontrado</p>";
        return;
      }

      const evento = data.evento;

      document.getElementById("evento-detail")!.innerHTML = `
        <div class="max-w-4xl mx-auto">
          ${evento.miniatura ? `<img src="${evento.miniatura}" alt="${evento.titulo}" class="w-full h-96 object-cover rounded-lg mb-6">` : ""}
          <h1 class="text-4xl font-bold mb-4">${evento.titulo}</h1>
          <p class="text-gray-600 mb-6">${evento.descripcion || ""}</p>
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
              <p class="text-sm text-gray-500">Fecha</p>
              <p class="font-semibold">${new Date(evento.fecha).toLocaleDateString()}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Hora</p>
              <p class="font-semibold">${evento.hora}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Ubicaci√≥n</p>
              <p class="font-semibold">${evento.distrito}, ${evento.provincia}, ${evento.region}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Aforo</p>
              <p class="font-semibold">${evento.aforo} personas</p>
            </div>
          </div>
          <button onclick="window.location.href='/comprar/${evento.id}'" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold">
            Comprar entradas
          </button>
        </div>
      `;
    } catch (error) {
      document.getElementById("evento-detail")!.innerHTML =
        `<p class="text-red-500">Error: ${error}</p>`;
    }
  }

  loadEvento();
</script>
